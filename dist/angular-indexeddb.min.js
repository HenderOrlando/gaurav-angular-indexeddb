/**
 * gaurav-angular-indexeddb - IndexedDB wrapper for Angular JS
 * @version v0.1.0
 * @link https://github.com/gauravgango/gaurav-angular-indexeddb
 * @license MIT
 */
function indexeddbProvider(e){"use strict";function n(e){function n(e,n){function t(){if(r.indexdb=l.indexedDB||l.mozIndexedDB||l.webkitIndexedDB||l.msIndexedDB,"object"!=typeof r.indexdb)throw"IndexedDB not supported";r.keyRange=l.IDBKeyRange||l.mozIDBKeyRange||l.webkitIDBKeyRange||l.msIDBKeyRange}var r=this;r.name=e,r.version=n,r.indexdb="",t(),r.open=new l.Promise(function(e,n){var t=r.indexdb.open(r.name,r.version);t.onupgradeneeded=function(n){e(n)},t.onerror=function(e){n(e)},t.onsuccess=function(n){e(n)}})}function t(t,r,i,o,a){function u(n){function t(){W.bound=null,W.index=null,W.caseInsensitive=!1,W.hasFilter=!1,W.filterFunction=null,W.whereInValues=null,W.whereNotInValues=null,W.withTables={},W.hasWith=!1,W.isDesc=!1,W.traverse="next",W.isWhereNumber=!1,W.originalWithRelation=null,W.likeString=null}function r(){var e=[];if(e.push(n.name),W.hasWith){var t=Object.keys(W.withTables);t.forEach(function(n){e.push(n)})}return e}function i(e){var n=angular.copy(e);return n=n.toString(),W.caseInsensitive?(n=n.toLowerCase(),null!==n.match(W.likeString.toLowerCase())):null!==n.match(W.likeString)}function o(t,i){var o=void 0===i||i===!1||null===i?"readonly":"readwrite",a=[],u={};return e(function(e,i){try{R=v.indexdb.open(v.name),R.onsuccess=function(l){var s=l.target.result;a=r(),x=s.transaction(a,o),W.hasWith&&(a.splice(0,1),a.forEach(function(e){u[e]=x.objectStore(e)})),V=x.objectStore(n.name),null!==W.index&&(V=V.index(W.index)),V=V.openCursor(W.bound,W.traverse),V.onsuccess=function(n){try{t(n,e,i,u)}catch(r){i(r)}},V.onerror=function(e){i(e)},x.onerror=function(e){i(e)}},R.onerror=function(e){i(e)}}catch(l){i(l)}})}function a(e,n){return n=void 0===n?!1:n,W.caseInsensitive&&"string"==typeof e&&(e=n===!0?e.toUpperCase():e.toLowerCase()),e}function l(e,n,t){if(W.caseInsensitive){var r=a(e.key);W.whereNotInValues.forEach(function(e){var n=a(angular.copy(e));n===r&&-1===t.indexOf(r)&&t.push(r)}),-1===t.indexOf(r)&&n.push(e.value)}else-1===W.whereNotInValues.indexOf(e.key)&&n.push(e.value);e["continue"](null,W.traverse)}function s(e,n,t,r,i,o,u){if(u=void 0===u?!0:u,W.caseInsensitive&&u){var l;return l=a(e.key),o.forEach(function(t){var r=a(angular.copy(t));r===l&&n.push(e.value)}),e["continue"](),0}if(r){if(e.key<o[t])return t+=1,e["continue"](),t}else if(e.key>o[t])return t+=1,e["continue"](),t;return e.key!==o[t]?(e["continue"](o[t],i),t):(n.push(e.value),t+=1,e["continue"](o[t],i),t)}function c(e,t,r){r=void 0===r?!1:r;var i=angular.copy(e),o=Object.keys(t);return o.forEach(function(e){i[e]=t[e]}),n.hasTimeStamp&&!r&&(i.updatedAt=Date.parse(Date())),r&&(i.updatedAt=Date.parse(Date())),i}function f(e,n){var t=Object.keys(n);return t.forEach(function(t){void 0===e[t]&&(e[t]=[]),n[t].forEach(function(n){if(n>=0)-1===e[t].indexOf(n)&&e[t].push(n);else{var r=e[t].indexOf(-1*n);-1!==r&&e[t].splice(r,1)}})}),e}function d(e,n,t){var r,i=!1;if(W.caseInsensitive){var o;return o=a(e.key),W.whereInValues.forEach(function(e){var n=a(angular.copy(e));n===o&&(i=!0)}),i&&(r=c(e.value,t),W.hasWith&&(r=f(r,W.originalWithRelation)),e.update(r)),e["continue"](),0}if(W.isDesc){if(e.key<W.whereInValues[n])return n+=1,e["continue"](),n}else if(e.key>W.whereInValues[n])return n+=1,e["continue"](),n;return e.key!==W.whereInValues[n]?(e["continue"](W.whereInValues[n]),n):(r=c(e.value,t),W.hasWith&&(r=f(r,W.originalWithRelation)),e.update(r),n+=1,e["continue"](W.whereInValues[n]),n)}function h(e,n,t){var r;if(W.caseInsensitive){var i=a(e.key);W.whereNotInValues.forEach(function(e){var t=a(angular.copy(e));t===i&&-1===n.indexOf(i)&&n.push(i)}),-1===n.indexOf(i)&&(r=c(e.value,t),W.hasWith&&(r=f(r,W.originalWithRelation)),e.update(r))}else-1===W.whereNotInValues.indexOf(e.key)&&(r=c(e.value,t),W.hasWith&&(r=f(r,W.originalWithRelation)),e.update(r));e["continue"]()}function p(e,t,r){var i=!1;if(W.caseInsensitive){var o;return o=a(e.key),W.whereInValues.forEach(function(e){var n=a(angular.copy(e));n===o&&(i=!0)}),i&&(r.push(e.value[n.fields.keyPathField]),e["delete"]()),e["continue"](),0}if(W.isDesc){if(e.key<W.whereInValues[t])return t+=1,e["continue"](),t}else if(e.key>W.whereInValues[t])return t+=1,e["continue"](),t;return e.key!==W.whereInValues[t]?(e["continue"](W.whereInValues[t]),t):(r.push(e.value[n.fields.keyPathField]),e["delete"](),t+=1,e["continue"](W.whereInValues[t]),t)}function y(e,t,r){if(W.caseInsensitive){var i=a(e.key);W.whereNotInValues.forEach(function(e){var n=a(angular.copy(e));n===i&&-1===t.indexOf(i)&&t.push(i)}),-1===t.indexOf(i)&&(r.push(e.value[n.fields.keyPathField]),e["delete"]())}else-1===W.whereNotInValues.indexOf(e.key)&&(r.push(e.value[n.fields.keyPathField]),e["delete"]());e["continue"]()}function g(e,n,t,r,i){if(i=void 0===i?!1:i){if(void 0===t)return void e(t)}else if(0===t.length)return void e(t);var o,a,u,l;l={},u=Object.keys(r),a=u.length;var c=0;o=[],u.forEach(function(u){i?o=angular.copy(t[W.originalWithRelation[u].field]):(t.forEach(function(e){var n=angular.copy(e[W.originalWithRelation[u].field]);void 0!==n&&n.constructor===Array&&n.forEach(function(e){-1===o.indexOf(e)&&o.push(e)})}),l[u]=[]);var f=0,d=[],h=!1;return"function"==typeof W.originalWithRelation[u].filter&&(h=!0),(void 0===o||o.constructor!==Array)&&e(t),o=o.sort(),0===o.length?(i?t.Relations=l:t.forEach(function(e){e.Relations=l}),void e(t)):(r[u].openCursor(v.keyRange.bound(o[0],o[o.length-1])).onsuccess=function(r){try{var l=r.target.result;if(l){if(h&&W.originalWithRelation[u].filter(l.value)!==!0)return f+=1,void l["continue"](o[f]);f=s(l,d,f,!1,"next",o,!1)}else i?(t.Relations=t.Relations||{},t.Relations[u]=[],d.forEach(function(e){-1!==t[W.originalWithRelation[u].field].indexOf(e._id)&&t.Relations[u].push(e)})):t.forEach(function(e){e.Relations=e.Relations||{},e.Relations[u]=[],d.forEach(function(n){void 0!==e[W.originalWithRelation[u].field]&&-1!==e[W.originalWithRelation[u].field].indexOf(n._id)&&e.Relations[u].push(n)})}),c+=1,c===a&&e(t)}catch(v){n(v)}},void(r[u].openCursor(v.keyRange.bound(o[0],o[o.length-1])).onerror=function(e){n(e)}))})}function b(e,t,r,i,o){var a,u;u=Object.keys(i),a=u.length;var l=0,s={};u.forEach(function(u){var f=!1,d=!1,h=[];"function"==typeof W.originalWithRelation[u].filter&&(f=!0),"object"==typeof W.originalWithRelation[u].many&&W.originalWithRelation[u].many.isMany===!0&&(d=!0),i[u].openCursor().onsuccess=function(i){var v=i.target.result;if(v){var p=c(v.value,{},!0);if(f&&W.originalWithRelation[u].filter(angular.copy(v.value))!==!0)return void v["continue"]();void 0===p[W.originalWithRelation[u].field]&&(p[W.originalWithRelation[u].field]=[]),-1===p[W.originalWithRelation[u].field].indexOf(r._id)&&(p[W.originalWithRelation[u].field].push(r._id),d&&h.push(v.value._id)),v.update(p),v["continue"]()}else if(l+=1,d===!0&&(s[W.originalWithRelation[u].many.field]=h),l===a)if(d){r=c(r,s);var y=o.objectStore(n.name);y.put(r).onsuccess=function(){e(r)},y.onerror=function(e){t(e)}}else e(r)},i[u].openCursor().onerror=function(e){t(e)}})}function m(e,n,t,r,i){i=void 0===i?!1:i;var o,a;a=Object.keys(r),o=a.length;var u,l=0;i?(t=t.sort(),u=v.keyRange.bound(t[0],t[t.length-1])):u=v.keyRange.only(t),a.forEach(function(a){r[a].index(W.originalWithRelation[a].field).openCursor(u).onsuccess=function(r){try{var u=r.target.result;if(u){var s=c(u.value,{},!0);if(void 0===s[W.originalWithRelation[a].field])return void u["continue"]();var f;if(i)t.forEach(function(e){f=s[W.originalWithRelation[a].field].indexOf(e),-1!==f&&s[W.originalWithRelation[a].field].splice(f,1)});else{if(f=s[W.originalWithRelation[a].field].indexOf(t),-1===f)return void u["continue"]();s[W.originalWithRelation[a].field].splice(f,1)}u.update(s),u["continue"]()}else l+=1,l===o&&e()}catch(d){n(d)}},r[a].onerror=function(e){n(e)}})}function w(e){var n=Object.keys(e);n.forEach(function(e){W.withTables[e]=new u(e)})}function k(e,n){return W.isDesc?n-e:e-n}function I(){if(W.isDesc){if(null!==W.whereInValues){if(W.isWhereNumber)return void(W.whereInValues=W.whereInValues.sort(k));W.whereInValues=W.whereInValues.reverse()}if(null!==W.whereNotInValues){if(W.isWhereNumber)return void(W.whereNotInValues=W.whereNotInValues.sort(k));W.whereNotInValues=W.whereNotInValues.reverse()}}else{if(null!==W.whereInValues){if(W.isWhereNumber)return void(W.whereInValues=W.whereInValues.sort(k));W.whereInValues=W.whereInValues.sort()}if(null!==W.whereNotInValues){if(W.isWhereNumber)return void(W.whereNotInValues=W.whereNotInValues.sort(k));W.whereNotInValues=W.whereNotInValues.sort()}}}var R,x,V,W=this;t(),W.orderDesc=function(e){return e===!0?(W.isDesc=!0,W.traverse="prev",I()):(W.isDesc=!1,W.traverse="next",I()),W},W.select=function(e){return e===n.fields.keyPathField?W:(W.index=e,W)},W.equal=function(e){return W.bound=v.keyRange.only(e),W},W.setCaseInsensitive=function(e){var n,t,r,i;return e=void 0===e||e===!0?!0:!1,W.caseInsensitive=e,W.caseInsensitive&&null!==W.bound&&W.bound.lower!==W.bound.upper&&(n=a(angular.copy(W.bound.lower),!0),i=void 0===W.bound.lowerOpen?!1:angular.copy(W.bound.lowerOpen),t=a(angular.copy(W.bound.upper)),r=void 0===W.bound.upper?!1:angular.copy(W.bound.upper),void 0===W.bound.lower?W.bound=v.keyRange.upperBound(t,r):void 0===W.bound.upper?W.bound=v.keyRange.lowerBound(n,i):W.bound=v.keyRange.bound(n,t,i,r)),W},W.find=function(){var t=e(function(e,t){var i=[],o={};try{R=v.indexdb.open(v.name),R.onsuccess=function(a){try{var u=a.target.result;i=r(),x=u.transaction(i),W.hasWith&&(i.splice(0,1),i.forEach(function(e){o[e]=x.objectStore(e)})),V=x.objectStore(n.name),null!==W.index&&(V=V.index(W.index)),V=V.get(W.bound),V.onsuccess=function(n){try{W.hasWith?g(e,t,n.target.result,o,!0):e(n.target.result)}catch(r){t(r)}},V.onerror=function(e){t(e)},x.onerror=function(e){t(e)}}catch(l){t(l)}},R.onerror=function(e){t(e)}}catch(a){t(a)}});return t},W.add=function(t){var i=e(function(e,i){try{var o=[],a={};R=v.indexdb.open(v.name),R.onsuccess=function(u){try{var l=u.target.result;o=r(),x=l.transaction(o,"readwrite"),W.hasWith&&(o.splice(0,1),o.forEach(function(e){a[e]=x.objectStore(e)})),V=x.objectStore(n.name),n.hasTimeStamp&&(t.updatedAt=Date.parse(Date()),t.createdAt=Date.parse(Date())),V=V.add(t),V.onsuccess=function(r){try{var o;o=t,o[n.fields.keyPathField]=r.target.result,W.hasWith?b(e,i,o,a,x):e(o)}catch(u){i(u)}},x.onerror=function(e){i(e.srcElement.error)}}catch(s){i(s)}},R.onerror=function(e){i(e)}}catch(u){i(u)}});return i},W.addMultiple=function(t){var r=[],i=t.length,o=0,a=e(function(e,a){try{R=v.indexdb.open(v.name),R.onsuccess=function(u){try{var l=u.target.result;x=l.transaction([n.name],"readwrite");try{V=x.objectStore(n.name),t.forEach(function(u){n.hasTimeStamp&&(u.updatedAt=Date.parse(Date()),u.createdAt=Date.parse(Date())),V.add(u).onsuccess=function(u){try{var l;l=t[o],l[n.fields.keyPathField]=u.target.result,r.push(l),o+=1,o===i&&e(r)}catch(s){a(s)}}})}catch(s){return void a(s)}x.onerror=function(e){a(e.srcElement.error)}}catch(s){a(s)}},R.onerror=function(e){a(e.srcElement.error)}}catch(u){a(u)}});return a},W.between=function(e,n,t,r){return t=void 0!==t?!1:t,r=void 0!==r?!1:r,W.bound=v.keyRange.bound(e,n,t,r),W},W.whereIn=function(e,n){return n=n===!0?!0:!1,W.whereInValues=e,W.isWhereNumber=n,I(),W},W.gt=function(e){return e=a(e,!0),W.bound=v.keyRange.lowerBound(e,!0),W},W.gte=function(e){return e=a(e,!0),W.bound=v.keyRange.lowerBound(e),W},W.lte=function(e){return e=a(e),W.bound=v.keyRange.upperBound(e),W},W.lt=function(e){return e=a(e),W.bound=v.keyRange.upperBound(e,!0),W},W.getAll=function(){var e=[],n=0,t=[],r=o(function(r,o,a,u){var c=r.target.result;if(c){if(W.hasFilter&&W.filterFunction(c.value)!==!0)return void c["continue"]();if(null!==W.likeString&&i(c.key)===!1)return void c["continue"]();null!==W.whereInValues?n=s(c,e,n,W.isDesc,W.traverse,W.whereInValues):null!==W.whereNotInValues?l(c,e,t):(e.push(c.value),c["continue"]())}else W.hasWith?g(o,a,e,u):o(e)});return r},W.whereNotIn=function(e,n){return n=n===!0?!0:!1,W.whereNotInValues=e,W.isWhereNumber=n,I(),W},W.put=function(t){var r=e(function(e,r){try{R=v.indexdb.open(v.name),R.onsuccess=function(i){var o=i.target.result;x=o.transaction([n.name],"readwrite"),V=x.objectStore(n.name),n.hasTimeStamp&&(t.updatedAt=Date.parse(Date()),void 0===t.createdAt&&(t.createdAt=Date.parse(Date()))),V=V.put(t),V.onsuccess=function(i){try{t[n.keyPathField]=i.target.result,e(t)}catch(o){r(o)}},V.onerror=function(e){r(e)},x.onerror=function(e){r(e)}},R.onerror=function(e){r(e.srcElement.error)}}catch(i){r(i)}});return r},W.update=function(e){if("object"!=typeof e)throw"Data must be type of object";var n=0,t=[],r=o(function(r,o){var a,u=r.target.result;if(u){if(W.hasFilter&&W.filterFunction(u.value)!==!0)return void u["continue"]();if(null!==W.likeString&&i(u.key)===!1)return void u["continue"]();null!==W.whereInValues?n=d(u,n,e):null!==W.whereNotInValues?h(u,t,e):(a=c(u.value,e),W.hasWith&&(a=f(a,W.originalWithRelation)),u.update(a),u["continue"]())}else o()},!0);return r},W.filter=function(e){return W.hasFilter=!0,W.filterFunction=e,W},W["delete"]=function(t){if(void 0===t)throw"Empty value provided for deleting";var i=e(function(e,i){try{R=v.indexdb.open(v.name),R.onsuccess=function(o){var a=o.target.result,u={},l=r();x=a.transaction(l,"readwrite"),W.hasWith&&(l.splice(0,1),l.forEach(function(e){u[e]=x.objectStore(e)})),V=x.objectStore(n.name),V=V["delete"](t),V.onsuccess=function(){try{W.hasWith?m(e,i,t,u):e()}catch(n){i(n)}},V.onerror=function(e){i(e)},x.onerror=function(e){i(e)}},R.onerror=function(e){i(e)}}catch(o){i(o)}});return i},W.destroy=function(){var e=0,t=[],r=[],a=o(function(o,a,u,l){var s=o.target.result;if(s){if(W.hasFilter&&W.filterFunction(s.value)!==!0)return void s["continue"]();if(null!==W.likeString&&i(s.key)===!1)return void s["continue"]();null!==W.whereInValues?e=p(s,e,r):null!==W.whereNotInValues?y(s,t,r):(r.push(s.value[n.fields.keyPathField]),s["delete"](),s["continue"]())}else W.hasWith?m(a,u,r,l,!0):a()},!0);return a},W.withRelations=function(e){if("object"!=typeof e)throw"WithRelation must be at type of object";return W.hasWith=!0,W.originalWithRelation=e,W.withRelation=w(e),W},W.like=function(e){if(void 0===e)throw"Invalid input given to like";return W.likeString=e.toString(),W}}function l(e){var n={};return e.hasOwnProperty("unique")&&e.unique&&(n.unique=!0),e.hasOwnProperty("multiEntry")&&e.multiEntry&&(n.multiEntry=!0),n}function s(e){return void 0===e.keyPathValue?e.name:e.keyPathValue}function c(e,n){var t;e.objectStoreNames.contains(n.name)&&(t=e.transaction([n.name]).objectStore(n.name),t.keyPath!==n.fields.keyPathField&&(n.fields.keyPathField=t.keyPath),v.models[n.name]={},Object.defineProperty(v.models,n.name,{get:function(){return new u(n)}}))}function f(e){var n,t;v.tables.forEach(function(r){e.objectStoreNames.contains(r.name)||(n=e.createObjectStore(r.name,{keyPath:r.fields.keyPathField,autoIncrement:!0}),r.fields.other.forEach(function(e){var r=s(e);t=l(e),n.createIndex(e.name,r,t)})),v.models[r.name]={},Object.defineProperty(v.models,r.name,{get:function(){return new u(r)}})})}function d(e,n){var t,r,i,o,a;for(i=!1,o={},o.other=[],a=[],t=e.length-1;t>=0;t--){if(r=e[t],"string"!=typeof r.name)throw"Field/Index name must be of string type";if(-1!==a.indexOf(r.name))throw"Field/Index name already exists";if(a.push(r.name),r.hasOwnProperty("keyPath"))if(r.keyPath===!0){if(i===!0)throw"Error multiple keyPath defined in table "+n;o.keyPathField=r.name,i=!0}else o.other.push(r);else o.other.push(r)}return i||(o.keyPathField="_id"),o}function h(){var e,n,t,r;for(r=[],e=v.tables.length-1;e>=0;e--){if(n=v.tables[e],"string"!=typeof n.name)throw"Table/ObjectStore name must be of string type";if(-1!==r.indexOf(n.name))throw"Repeated Table/ObjectStore name "+n.name;r.push(n.name),n.hasTimeStamp=!1,t=d(n.fields,n.name),n.fields=t,n.timeStamps===!0&&(n.hasTimeStamp=!0,n.indexOnTimeStamps===!0&&(n.fields.other.push({name:"updatedAt",keyPathValue:"updatedAt",multiEntry:!0}),n.fields.other.push({name:"createdAt",keyPathValue:"createdAt",multiEntry:!0})))}}n.apply(this,[t,r]);var v=this;v.tables=i||[],v.models={},h(),v.open.then(function(e){var n,t;if("upgradeneeded"===e.type)f(e.target.result);else for(n=v.tables.length-1;n>=0;n--)t=v.tables[n],c(e.target.result,t);o(v)})["catch"](function(e){a(e)})}return e(function(e,n){var r=new t(o,a,u,e,n);return r})}function t(e){o=e}function r(e){u=e}function i(e){a=e}var o,a,u,l=e.$get();return o="test",a=1,u=[],n.$inject=["$q"],{setDbName:t,setDbVersion:i,setDbTables:r,$get:n}}indexeddbProvider.$inject=["$windowProvider"],angular.module("indexed-db",[]),angular.module("indexed-db").provider("indexeddb",indexeddbProvider);
//# sourceMappingURL=angular-indexeddb.min.js.map