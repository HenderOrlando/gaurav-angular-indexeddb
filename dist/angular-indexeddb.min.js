/**
 * gaurav-angular-indexeddb - IndexedDB wrapper for Angular JS
 * @version v0.1.0
 * @link https://github.com/gauravgango/gaurav-angular-indexeddb
 * @license MIT
 */
function indexeddbProvider(e){"use strict";function t(e){function t(e,t){function n(){if(r.indexdb=s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,"object"!=typeof r.indexdb)throw"IndexedDB not supported";r.keyRange=s.IDBKeyRange||s.mozIDBKeyRange||s.webkitIDBKeyRange||s.msIDBKeyRange}var r=this;r.name=e,r.version=t,r.indexdb="",n(),r.open=new s.Promise(function(e,t){var n=r.indexdb.open(r.name,r.version);n.onupgradeneeded=function(t){e(t)},n.onerror=function(e){t(e)},n.onsuccess=function(t){e(t)}}),r.openConnection=new s.Promise(function(e,t){var n=r.indexdb.open(r.name);n.onerror=function(e){t(e)},n.onsuccess=function(t){e(t)}})}function n(){var e=this,t={};t.isDesc=!1,e.changeCase=function(e,t,n){return t=void 0===t?!1:t,n&&"string"==typeof e&&(e=t===!0?e.toUpperCase():e.toLowerCase()),e},e.checkLikeString=function(e,t,n){var r=angular.copy(e);return r=r.toString(),n?(r=r.toLowerCase(),null!==r.match(t.toLowerCase())):null!==r.match(t)},e.whereIn=function(t,n,r){if(r=void 0===r?!1:r){var i,a;return a=!1,i=e.changeCase(t,!1,!0),n.forEach(function(t){var n=e.changeCase(angular.copy(t),!1,!0);n===i&&(a=!0)}),a}return-1!==n.indexOf(t)},e.setOrderSettings=function(e,n,r){return r&&(t.isDesc=!0),e=n?e.sort(t._sortAsNumbers):t.isDesc?e.reverse():e.sort(),t.isDesc=!1,e},e.sortAsNumbers=function(e,n){return t.isDesc?n-e:e-n},e.whereNotIn=function(t,n,r){if(r){var i=e.changeCase(t,!1,!0),a=!1;if(n.forEach(function(t){var n=e.changeCase(angular.copy(t),!1,!0);n===i&&(a=!0)}),!a)return!0}else if(-1===n.indexOf(t))return!0;return!1},e.getPropertyValue=function(e,t){var n,r,i=angular.copy(t);if(r=e.split("."),r.length>1)for(n=0;n<=r.length-1;n++){if(void 0===i[r[n]])return void 0;i=i[r[n]]}else i=i[r[0]];return i},e.maxValue=function(e,t){return e>=t?e:t},e.minValue=function(e,t){return t>=e?e:t}}function r(r,i,a,o,u){function s(e){function t(){r.bound=null,r.index=null,r.caseInsensitive=!1,r.hasFilter=!1,r.filterFunction=null,r.whereInValues=null,r.whereNotInValues=null,r.withTables={},r.hasWith=!1,r.isDesc=!1,r.traverse="next",r.isWhereNumber=!1,r.originalWithRelation=null,r.likeString=null}function n(e){var t=Object.keys(e);t.forEach(function(e){var t=y.tables.filter(function(t){return t.name===e})[0];r.withTables[e]=new s(t)})}var r=this;t(),r.gt=function(e){return e=y.helper.changeCase(e,!0,r.caseInsensitive),r.bound=y.keyRange.lowerBound(e,!0),r},r.gte=function(e){return e=y.helper.changeCase(e,!0,r.caseInsensitive),r.bound=y.keyRange.lowerBound(e),r},r.lte=function(e){return e=y.helper.changeCase(e,!1,r.caseInsensitive),r.bound=y.keyRange.upperBound(e),r},r.lt=function(e){return e=y.helper.changeCase(e,!1,r.caseInsensitive),r.bound=y.keyRange.upperBound(e,!0),r},r.orderDesc=function(e){return r.isDesc=!1,r.traverse="next",e===!0&&(r.isDesc=!0,r.traverse="prev"),null!==r.whereInValues&&(r.whereInValues=y.helper.setOrderSettings(r.whereInValues,r.isWhereNumber,r.isDesc)),null!==r.whereNotInValues&&(r.whereNotInValues=y.helper.setOrderSettings(r.whereNotInValues,r.isWhereNumber,r.isDesc)),r},r.select=function(t){return t===e.fields.keyPathField?r:(r.index=t,r)},r.equal=function(e){return r.bound=y.keyRange.only(e),r},r.setCaseInsensitive=function(e){var t,n,i,a;return e=void 0===e||e===!0?!0:!1,r.caseInsensitive=e,r.caseInsensitive&&null!==r.bound&&r.bound.lower!==r.bound.upper&&(t=y.helper.changeCase(angular.copy(r.bound.lower),!0,!0),a=void 0===r.bound.lowerOpen?!1:angular.copy(r.bound.lowerOpen),n=y.helper.changeCase(angular.copy(r.bound.upper),!1,!0),i=void 0===r.bound.upperOpen?!1:angular.copy(r.bound.upperOpen),void 0===r.bound.lower?r.bound=y.keyRange.upperBound(n,i):void 0===r.bound.upper?r.bound=y.keyRange.lowerBound(t,a):r.bound=y.keyRange.bound(t,n,a,i)),r},r.between=function(e,t,n,i){return n=void 0!==n?!1:n,i=void 0!==i?!1:i,r.caseInsensitive&&(e=y.helper.changeCase(e,!0,!0),t=y.helper.changeCase(t,!1,!0)),r.bound=y.keyRange.bound(e,t,n,i),r},r.whereIn=function(e,t){return t=t===!0?!0:!1,r.whereInValues=e,r.isWhereNumber=t,r.caseInsensitive&&(r.whereInValues=y.helper.setOrderSettings(r.whereInValues,t,r.isDesc)),r},r.whereNotIn=function(e,t){return t=t===!0?!0:!1,r.whereNotInValues=e,r.isWhereNumber=t,r.caseInsensitive&&(r.whereNotInValues=y.helper.setOrderSettings(r.whereNotInValues,t,r.isDesc)),r},r.filter=function(e){if(r.hasFilter=!0,"function"!=typeof e)throw"A function must be given as parameter for filter";return r.filterFunction=e,r},r.like=function(e){if(void 0===e)throw"Invalid input given to like";return r.likeString=e.toString(),r},r.withRelations=function(e){if("object"!=typeof e)throw"WithRelation must be at type of object";return r.hasWith=!0,r.originalWithRelation=e,r.withRelation=n(e),r}}function l(e){function t(){n.sums=[],n.mins=[],n.maxs=[],n.averages=[],n.customs=[]}s.call(this,e);var n=this;t(),n.sum=function(t){return void 0===t&&(t=null===n.index?e.fields.keyPathField:n.index),-1===n.sums.indexOf(t)&&n.sums.push(t),n},n.min=function(t){return void 0===t&&(t=null===n.index?e.fields.keyPathField:n.index),-1===n.mins.indexOf(t)&&n.mins.push(t),n},n.max=function(t){return void 0===t&&(t=null===n.index?e.fields.keyPathField:n.index),-1===n.maxs.indexOf(t)&&n.maxs.push(t),n},n.average=function(t){return void 0===t&&(t=null===n.index?e.fields.keyPathField:n.index),-1===n.averages.indexOf(t)&&n.averages.push(t),n},n.custom=function(e,t,r){if("string"!=typeof e)throw"Custom aggregate first parameter must be a string";if("function"!=typeof t)throw"Custom aggregate second parameter must be a function";if(void 0!==r&&"function"!=typeof r)throw"Custom aggregate third parameter must be a function";var i={};i.callback=t,i.endCallback=r,i.name=e;var a=n.customs.filter(function(t){return t.name===e});if(0!==a.length)throw"Repeated Custom aggregate name given : "+e;return n.customs.push(i),n}}function c(e){function t(){n.andObject=null,n.orObject=null,n.inObject=null,n.notInObject=null,n.likeObject=null,n.gtObject=null,n.gteObject=null,n.ltObject=null,n.lteObject=null}l.apply(this,[e]);var n=this;t(),n.whereOtherAnd=function(e,t){var r={};if("string"!=typeof e)throw"Invalid first argument. Property name must be a string";return null===n.andObject&&(n.andObject=[]),r.propertyName=e,r.propertyValue=t,n.andObject.push(r),n},n.whereOtherOr=function(e,t){var r={};if("string"!=typeof e)throw"Invalid first argument. Property name must be a string";return null===n.orObject&&(n.orObject=[]),r.propertyName=e,r.propertyValue=t,n.orObject.push(r),n},n.whereOtherIn=function(e,t){var r={};if("string"!=typeof e)throw"Invalid first argument. Property name must be a string";if(t.constructor!==Array)throw"Invalid second argument. Property value must be an array";return null===n.inObject&&(n.inObject=[]),r.propertyName=e,r.propertyValue=t,n.inObject.push(r),n},n.whereOtherNotIn=function(e,t){var r={};if("string"!=typeof e)throw"Invalid first argument. Property name must be a string";if(t.constructor!==Array)throw"Invalid second argument. Property value must be an array";return null===n.notInObject&&(n.notInObject=[]),r.propertyName=e,r.propertyValue=t,n.notInObject.push(r),n},n.whereOtherLike=function(e,t){var r={};if("string"!=typeof e)throw"Invalid first argument. Property name must be a string";if("string"!=typeof t)throw"Invalid second argument. Property value must be an string";return r.propertyName=e,r.propertyValue=t,n.likeObject.push(r),n},n.whereOtherGt=function(e,t){var r={};if("string"!=typeof e)throw"Invalid first argument. Property name must be a string";if(void 0===t||""===t)throw"Invalid second argument. Property value cannot be empty";return r.propertyName=e,r.propertyValue=t,n.gtObject.push(r),n},n.whereOtherGte=function(e,t){var r={};if("string"!=typeof e)throw"Invalid first argument. Property name must be a string";if(void 0===t||""===t)throw"Invalid second argument. Property value cannot be empty";return r.propertyName=e,r.propertyValue=t,n.gteObject.push(r),n},n.whereOtherLte=function(e,t){var r={};if("string"!=typeof e)throw"Invalid first argument. Property name must be a string";if(void 0===t||""===t)throw"Invalid second argument. Property value cannot be empty";return r.propertyName=e,r.propertyValue=t,n.lteObject.push(r),n},n.whereOtherLt=function(e,t){var r={};if("string"!=typeof e)throw"Invalid first argument. Property name must be a string";if(void 0===t||""===t)throw"Invalid second argument. Property value cannot be empty";return r.propertyName=e,r.propertyValue=t,n.ltObject.push(r),n}}function f(t){function n(e){var t,n,r,i,a,o;if(r=!0,i=!1,a=!1,l.hasFilter&&l.filterFunction(e.value)!==!0)return!1;if(null!==l.likeString&&y.helper.checkLikeString(e.key,l.likeString,l.caseInsensitive)===!1)return!1;if(null!==l.whereInValues&&!y.helper.whereIn(e.key,l.whereInValues,l.caseInsensitive))return!1;if(null!==l.whereNotInValues&&!y.helper.whereNotIn(e.key,l.whereNotInValues,l.caseInsensitive))return!1;if(null!==l.inObject)for(t=l.inObject.length-1;t>=0;t--){if(o=l.inObject[t],n=y.helper.getPropertyValue(o.propertyName,e.value),void 0===n)return!1;if(!y.helper.whereIn(n,o.propertyValue,l.caseInsensitive))return!1}if(null!==l.notInObject)for(t=l.notInObject.length-1;t>=0;t--)if(o=l.notInObject[t],n=y.helper.getPropertyValue(o.propertyName,e.value),void 0!==n&&!y.helper.whereNotIn(n,o.propertyValue,l.caseInsensitive))return!1;if(null!==l.likeObject)for(t=l.likeObject.length-1;t>=0;t--){if(o=l.likeObject[t],n=y.helper.getPropertyValue(o.propertyName,e.value),void 0===n)return!1;if(!y.helper.checkLikeString(n,o.propertyValue,l.caseInsensitive))return!1}if(null!==l.gteObject)for(t=l.gteObject.length-1;t>=0;t--){if(o=l.gteObject[t],n=y.helper.getPropertyValue(o.propertyName,e.value),void 0===n)return!1;if(o.propertyValue<n)return!1}if(null!==l.gtObject)for(t=l.gtObject.length-1;t>=0;t--){if(o=l.gtObject[t],n=y.helper.getPropertyValue(o.propertyName,e.value),void 0===n)return!1;if(o.propertyValue<=n)return!1}if(null!==l.lteObject)for(t=l.lteObject.length-1;t>=0;t--){if(o=l.lteObject[t],n=y.helper.getPropertyValue(o.propertyName,e.value),void 0===n)return!1;if(o.propertyValue>n)return!1}if(null!==l.ltObject)for(t=l.ltObject.length-1;t>=0;t--){if(o=l.ltObject[t],n=y.helper.getPropertyValue(o.propertyName,e.value),void 0===n)return!1;if(o.propertyValue>=n)return!1}if(null!==l.andObject)for(a=!0,t=l.andObject.length-1;t>=0;t--)if(o=l.andObject[t],n=y.helper.getPropertyValue(o.propertyName,e.value),void 0===n||n!==o.propertyValue){r=!1;break}if(null!==l.orObject){if(i=!1,!a&&(r=!1,0===l.orObject.length))return!0;for(t=l.orObject.length-1;t>=0;t--)if(o=l.orObject[t],n=y.helper.getPropertyValue(o.propertyName,e.value),void 0!==n&&n===o.propertyValue){i=!0;break}}return r||i?!0:!1}function r(){var e=[];if(e.push(t.name),l.hasWith){var n=Object.keys(l.withTables);n.forEach(function(t){e.push(t)})}return e}function i(n,i){var a=void 0===i||i===!1||null===i?"readonly":"readwrite",o=[],c={};return e(function(e,i){y.openConnection.then(function(f){try{var h=f.target.result;o=r(),u=h.transaction(o,a),l.hasWith&&(o.splice(0,1),o.forEach(function(e){c[e]=u.objectStore(e)})),s=u.objectStore(t.name),null!==l.index&&(s=s.index(l.index)),s=s.openCursor(l.bound,l.traverse),s.onsuccess=function(t){try{n(t,e,i,c)}catch(r){u.abort(),i(r)}},s.onerror=function(e){u.abort(),i(e)},u.onerror=function(e){i(e)}}catch(d){i(d)}})["catch"](function(e){i(e)})})}function a(e,n,r){r=void 0===r?!1:r;var i=angular.copy(e),a=Object.keys(n);return a.forEach(function(e){i[e]=n[e]}),t.hasTimeStamp&&!r&&(i.updatedAt=Date.parse(Date())),r&&(i.updatedAt=Date.parse(Date())),i}function o(){var e=this;e.count=function(){var e=0,t=i(function(t,r){var i=t.target.result;if(i){if(!n(i))return i["continue"](),!1;e+=1,i["continue"]()}else r(e)});return t},e.sum=function(e){var r,a=0;void 0===e&&(e=null===l.index?t.fields.keyPathField:l.index);var o=i(function(t,i){var o=t.target.result;if(o){if(!n(o))return o["continue"](),!1;r=y.helper.getPropertyValue(e,o.value),"number"==typeof r&&(a+=r),o["continue"]()}else i(a)});return o},e.max=function(e){var r,a=null;void 0===e&&(e=null===l.index?t.fields.keyPathField:l.index);var o=i(function(t,i){var o=t.target.result;if(o){if(!n(o))return o["continue"](),!1;r=y.helper.getPropertyValue(e,o.value),void 0!==r&&(a=null===a?r:y.helper.maxValue(a,r)),o["continue"]()}else i(a)});return o},e.min=function(e){var r,a=null;void 0===e&&(e=null===l.index?t.fields.keyPathField:l.index);var o=i(function(t,i){var o=t.target.result;if(o){if(!n(o))return o["continue"](),!1;r=y.helper.getPropertyValue(e,o.value),void 0!==r&&(a=null===a?r:y.helper.minValue(a,r)),o["continue"]()}else i(a)});return o},e.average=function(e){var r,a=0,o=0,u=0;void 0===e&&(e=null===l.index?t.fields.keyPathField:l.index);var s=i(function(t,i){var s=t.target.result;if(s){if(!n(s))return s["continue"](),!1;u++,r=y.helper.getPropertyValue(e,s.value),"number"==typeof r&&(o+=r),s["continue"]()}else a=0===o&&0===u?0:o/u,i(a)});return s},e.custom=function(e,t){if("function"!=typeof e)throw"Parameter passed to custom aggregate must be of function type";var r=0,a=i(function(i,a,o){var s=i.target.result;if(s){if(!n(s))return s["continue"](),!1;try{r=e(r,angular.copy(s.value))}catch(l){return u.abort(),o(l),!1}s["continue"]()}else"function"==typeof t&&(r=t(r)),a(r)});return a}}c.apply(this,[t]);var u,s,l=this,f={},h={};f.getRelationData=function(e,t,n){var r;return t?(r=angular.copy(e[n]),void 0===r?!1:(r.constructor!==Array&&(r=[r]),r=r.sort())):(r=[],e.forEach(function(e){void 0!==e[n]&&e[n].forEach(function(e){-1===r.indexOf(e)&&r.push(e)})}),r=r.sort(),0===r.length?!1:r)},f.setOutcome=function(e,t,n,r,i){var a=y.tables.filter(function(e){return e.name===t})[0];return i?(e.Relations=e.Relations||{},e.Relations[t]=[],r.forEach(function(r){e[n].indexOf(r[a.fields.keyPathField])>0&&e.Relations[t].push(r)}),e):(e.forEach(function(e){e.Relations=e.Relations||{},e.Relations[t]=[],r.forEach(function(r){return void 0===e[n]?!1:void(e[n].indexOf(r[a.fields.keyPathField])>=0&&e.Relations[t].push(r))})}),e)},f.getWithAllData=function(e,t,n,r,i){i=void 0===i?!1:i;var a,o;o=Object.keys(r),a=o.length;var s=0;o.forEach(function(o){var c;if(c=f.getRelationData(n,i,l.originalWithRelation[o].field),c===!1)return n=f.setOutcome(n,o,l.originalWithRelation[o].field,[],i),s+=1,s===a&&e(n),!1;var h=[],d=!1;"function"==typeof l.originalWithRelation[o].filter&&(d=!0),r[o].openCursor(y.keyRange.bound(c[0],c[c.length-1])).onsuccess=function(r){try{var p=r.target.result;if(p){if(d&&l.originalWithRelation[o].filter(p.value)!==!0)return p["continue"](),!1;if(!y.helper.whereIn(p.key,c,!1))return p["continue"](),!1;h.push(p.value),p["continue"]()}else n=f.setOutcome(n,o,l.originalWithRelation[o].field,h,i),s+=1,s===a&&e(n)}catch(v){u.abort(),t(v)}},r[o].openCursor(y.keyRange.bound(c[0],c[c.length-1])).onerror=function(e){u.abort(),t(e)}})},h.getSums=function(e,t){return 0===l.sums.length?e:(e.sums=e.sums||{},l.sums.forEach(function(n){e.sums[n]=void 0===e.sums[n]?0:e.sums[n];var r=y.helper.getPropertyValue(n,t);"number"==typeof r&&(e.sums[n]=e.sums[n]+r)}),e)},h.getMins=function(e,t){return 0===l.mins.length?e:(e.mins=e.mins||{},l.mins.forEach(function(n){var r=y.helper.getPropertyValue(n,t);return void 0===r?!1:(e.mins[n]=void 0===e.mins[n]?r:e.mins[n],void(e.mins[n]=y.helper.minValue(e.mins[n],r)))}),e)},h.getMaxs=function(e,t){return 0===l.mins.length?e:(e.maxs=e.maxs||{},l.maxs.forEach(function(n){var r=y.helper.getPropertyValue(n,t);return void 0===r?!1:(e.maxs[n]=void 0===e.maxs[n]?r:e.maxs[n],void(e.maxs[n]=y.helper.maxValue(e.maxs[n],r)))}),e)},h.getAverages=function(e,t,n){return 0===l.averages.length?e:(e.averages=e.averages||{},l.averages.forEach(function(r){if(n===!0)return e.averages[r]=e.averages[r]/t,!1;e.averages[r]=void 0===e.averages[r]?0:e.averages[r];var i=y.helper.getPropertyValue(r,t);"number"==typeof i&&(e.averages[r]=e.averages[r]+i)}),e)},h.getCustoms=function(e,t,n){return 0===l.customs.length?e:(e.customs=e.customs||{},l.customs.forEach(function(r){if(n===!0&&void 0!==r.endCallback)return e.customs[r.name]=r.endCallback(e[r.name],t),!1;e.customs[r.name]=void 0===e.customs[r.name]?0:e.customs[r.name];var i=y.helper.getPropertyValue(r.name,t);e.customs[r.name]=r.callback(e.customs[r.name],i)}),e)},f.update=function(e,t){var n=Object.keys(t);return n.forEach(function(n){void 0===e[n]&&(e[n]=[]),t[n].forEach(function(t){if(t>=0)-1===e[n].indexOf(t)&&e[n].push(t);else{var r=e[n].indexOf(-1*t);-1!==r&&e[n].splice(r,1)}})}),e},f.add=function(e,n,r,i,o){var u,s;s=Object.keys(i),u=s.length;var c=0,f={};s.forEach(function(s){var h=!1,d=!1,p=[];"function"==typeof l.originalWithRelation[s].filter&&(h=!0),"object"==typeof l.originalWithRelation[s].many&&l.originalWithRelation[s].many.isMany===!0&&(d=!0),i[s].openCursor().onsuccess=function(i){var v=i.target.result;if(v){var g=a(v.value,{},!0);if(h&&l.originalWithRelation[s].filter(angular.copy(v.value))!==!0)return void v["continue"]();void 0===g[l.originalWithRelation[s].field]&&(g[l.originalWithRelation[s].field]=[]),-1===g[l.originalWithRelation[s].field].indexOf(r._id)&&(g[l.originalWithRelation[s].field].push(r._id),d&&p.push(v.value._id)),v.update(g),v["continue"]()}else if(c+=1,d===!0&&(f[l.originalWithRelation[s].many.field]=p),c===u)if(d){r=a(r,f);var m=o.objectStore(t.name);m.put(r).onsuccess=function(){e(r)},m.onerror=function(e){o.abort(),n(e)}}else e(r)},i[s].openCursor().onerror=function(e){o.abort(),n(e)}})},f.destroy=function(e,t,n,r,i,o){i=void 0===i?!1:i;var s,c;c=Object.keys(r),s=c.length;var f,h=0;i?(n=n.sort(),f=y.keyRange.bound(n[0],n[n.length-1])):f=y.keyRange.only(n),c.forEach(function(c){r[c].index(l.originalWithRelation[c].field).openCursor(f).onsuccess=function(r){try{var f=r.target.result;if(f){var d=a(f.value,{},!0);if(void 0===d[l.originalWithRelation[c].field])return void f["continue"]();var p;if(i)n.forEach(function(e){p=d[l.originalWithRelation[c].field].indexOf(e),-1!==p&&d[l.originalWithRelation[c].field].splice(p,1)});else{if(p=d[l.originalWithRelation[c].field].indexOf(n),-1===p)return void f["continue"]();d[l.originalWithRelation[c].field].splice(p,1)}f.update(d),f["continue"]()}else h+=1,h===s&&e(o)}catch(v){u.abort(),t(v)}},r[c].onerror=function(e){u.abort(),t(e)}})},l.find=function(){var n=e(function(e,n){y.openConnection.then(function(i){var a=[],o={};try{var c=i.target.result;a=r(),u=c.transaction(a),l.hasWith&&(a.splice(0,1),a.forEach(function(e){o[e]=u.objectStore(e)})),s=u.objectStore(t.name),null!==l.index&&(s=s.index(l.index)),s=s.get(l.bound),s.onsuccess=function(t){try{if(void 0===t)return e(t),!1;if(l.hasWith)return f.getWithAllData(e,n,t.target.result,o,!0),!1;e(t.target.result)}catch(r){u.abort(),n(r)}},s.onerror=function(e){u.abort(),n(e)},u.onerror=function(e){n(e)}}catch(h){n(h)}})["catch"](function(e){n(e)})});return n},l.add=function(n){var i=e(function(e,i){y.openConnection.then(function(a){var o=[],c={};try{var h=a.target.result;o=r(),u=h.transaction(o,"readwrite"),l.hasWith&&(o.splice(0,1),o.forEach(function(e){c[e]=u.objectStore(e)})),s=u.objectStore(t.name),t.hasTimeStamp&&(n.updatedAt=Date.parse(Date()),n.createdAt=Date.parse(Date())),s=s.add(n),s.onsuccess=function(r){try{var a;a=n,a[t.fields.keyPathField]=r.target.result,l.hasWith?f.add(e,i,a,c,u):e(a)}catch(o){u.abort(),i(o)}},s.onerror=function(e){u.abort(),i(e)},u.onerror=function(e){i(e.srcElement.error)}}catch(d){i(d)}})["catch"](function(e){i(e)})});return i},l.addMultiple=function(n){var r=[],i=n.length,a=0,o=e(function(e,o){y.openConnection.then(function(l){try{var c=l.target.result;u=c.transaction([t.name],"readwrite");try{s=u.objectStore(t.name),n.forEach(function(l){t.hasTimeStamp&&(l.updatedAt=Date.parse(Date()),l.createdAt=Date.parse(Date())),s.add(l).onsuccess=function(s){try{var l;l=n[a],l[t.fields.keyPathField]=s.target.result,r.push(l),a+=1,a===i&&e(r)}catch(c){u.abort(),o(c)}}})}catch(f){return u.abort(),void o(f)}u.onerror=function(e){o(e.srcElement.error)}}catch(f){o(f)}})["catch"](function(e){o(e)})});return o},l.getAll=function(){var e=[],t=i(function(t,r,i,a){var o=t.target.result;if(o){if(!n(o))return o["continue"](),!1;e.push(o.value),o["continue"]()}else{if(0===e.length)return r(e),!1;if(l.hasWith)return f.getWithAllData(r,i,e,a),!1;r(e)}});return t},l.put=function(n){var r=e(function(e,r){y.openConnection.then(function(i){try{var a=i.target.result;u=a.transaction([t.name],"readwrite"),s=u.objectStore(t.name),t.hasTimeStamp&&(n.updatedAt=Date.parse(Date()),void 0===n.createdAt&&(n.createdAt=Date.parse(Date()))),void 0===n[t.fields.keyPathField]&&(u.abort(),r(new Error("KeyPath field not provied for update"))),s=s.put(n),s.onsuccess=function(i){try{n[t.keyPathField]=i.target.result,e(n)}catch(a){u.abort(),r(a)}},s.onerror=function(e){u.abort(),r(e)},u.onerror=function(e){r(e)}}catch(o){r(o)}})["catch"](function(e){r(e)})});return r},l.update=function(e){if("object"!=typeof e)throw"Data must be type of object";var t=0,r=i(function(r,i){var o,u=r.target.result;if(u){if(!n(u))return u["continue"](),!1;o=a(u.value,e),l.hasWith&&(o=f.update(o,l.originalWithRelation)),u.update(o),t+=1,u["continue"]()}else i(t)},!0);return r},l["delete"]=function(n){if(void 0===n)throw"Empty value provided for deleting";var i,a=e(function(e,a){y.openConnection.then(function(o){try{var c=o.target.result,h={},d=r();u=c.transaction(d,"readwrite"),l.hasWith&&(d.splice(0,1),d.forEach(function(e){h[e]=u.objectStore(e)})),s=u.objectStore(t.name),i=u.objectStore(t.name),s.get(n).onsuccess=function(t){return void 0===t.target.result?(e(0),!1):(i=i["delete"](n),i.onsuccess=function(){try{l.hasWith?f.destroy(e,a,n,h,1):e(1)}catch(t){u.abort(),a(t)}},void(i.onerror=function(e){u.abort(),a(e)}))},u.onerror=function(e){a(e)}}catch(p){a(p)}})["catch"](function(e){a(e)})});return a},l.destroy=function(){var e=0,r=[],a=i(function(i,a,o,u){var s=i.target.result;if(s){if(!n(s))return s["continue"](),!1;r.push(s.value[t.fields.keyPathField]),s["delete"](),e+=1,s["continue"]()}else l.hasWith?f.destroy(a,o,r,u,!0,e):a(e)},!0);return a},l.getAggregate=function(){var e=0,t={},r=i(function(r,i,a){var o=r.target.result;if(o){if(!n(o))return o["continue"](),!1;e+=1;try{t=h.getSums(t,o.value),t=h.getAverages(t,o.value,!1),t=h.getMins(t,o.value),t=h.getMaxs(t,o.value),t=h.getCustoms(t,o.value,!1)}catch(u){a(u)}o["continue"]()}else t=h.getAverages(t,e,!0),t=h.getCustoms(t,e,!0),i(t)});return r},l.aggregate=new o}function h(e){var t={};return e.hasOwnProperty("unique")&&e.unique&&(t.unique=!0),e.hasOwnProperty("multiEntry")&&e.multiEntry&&(t.multiEntry=!0),t}function d(e){return void 0===e.keyPathValue?e.name:e.keyPathValue}function p(e,t){var n;e.objectStoreNames.contains(t.name)&&(n=e.transaction([t.name]).objectStore(t.name),n.keyPath!==t.fields.keyPathField&&(t.fields.keyPathField=n.keyPath),y.models[t.name]={},Object.defineProperty(y.models,t.name,{get:function(){return new f(t)}}))}function v(e){var t,n,r;n=e.result,r=e.transaction,y.tables.forEach(function(e){var i;n.objectStoreNames.contains(e.name)?(i=r.objectStore(e.name),e.fields.other.forEach(function(e){var n=d(e);t=h(e),i.indexNames.contains(e.name)||i.createIndex(e.name,n,t)})):(i=n.createObjectStore(e.name,{keyPath:e.fields.keyPathField,autoIncrement:!0}),e.fields.other.forEach(function(e){var n=d(e);t=h(e),i.createIndex(e.name,n,t)})),y.models[e.name]={},Object.defineProperty(y.models,e.name,{get:function(){return new f(e)}})})}function g(e,t){var n,r,i,a,o;for(i=!1,a={},a.other=[],o=[],n=e.length-1;n>=0;n--){if(r=e[n],"string"!=typeof r.name)throw"Field/Index name must be of string type";if(-1!==o.indexOf(r.name))throw"Field/Index name already exists";if(o.push(r.name),r.hasOwnProperty("keyPath"))if(r.keyPath===!0){if(i===!0)throw"Error multiple keyPath defined in table "+t;a.keyPathField=r.name,i=!0}else a.other.push(r);else a.other.push(r)}return i||(a.keyPathField="_id"),a}function m(){var e,t,n,r;for(r=[],e=y.tables.length-1;e>=0;e--){if(t=y.tables[e],"string"!=typeof t.name)throw"Table/ObjectStore name must be of string type";if(-1!==r.indexOf(t.name))throw"Repeated Table/ObjectStore name "+t.name;r.push(t.name),t.hasTimeStamp=!1,n=g(t.fields,t.name),t.fields=n,t.timeStamps===!0&&(t.hasTimeStamp=!0,t.indexOnTimeStamps===!0&&(t.fields.other.push({name:"updatedAt",keyPathValue:"updatedAt",multiEntry:!0}),t.fields.other.push({name:"createdAt",keyPathValue:"createdAt",multiEntry:!0})))}}t.apply(this,[r,i]),this.helper={},n.apply(this.helper,[]);var y=this;y.tables=a||[],y.models={},m(),y.open.then(function(e){try{var t,n;if("upgradeneeded"===e.type)v(e.target);else for(t=y.tables.length-1;t>=0;t--)n=y.tables[t],p(e.target.result,n)}catch(r){u(r)}o(y)})["catch"](function(e){u(e)})}return e(function(e,t){var n=new r(a,o,u,e,t);return n})}function n(e){a=e}function r(e){u=e}function i(e){o=e}var a,o,u,s=e.$get();return a="test",o=1,u=[],t.$inject=["$q"],{setDbName:n,setDbVersion:i,setDbTables:r,$get:t}}indexeddbProvider.$inject=["$windowProvider"],angular.module("indexed-db",[]),angular.module("indexed-db").provider("indexeddb",indexeddbProvider);
//# sourceMappingURL=angular-indexeddb.min.js.map