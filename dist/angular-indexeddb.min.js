/**
 * gaurav-angular-indexeddb - IndexedDB wrapper for Angular JS
 * @version v0.0.2
 * @link https://github.com/gauravgango/gaurav-angular-indexeddb
 * @license MIT
 */
function indexeddbProvider(e){"use strict";function n(e){function n(e,n){function t(){if(r.indexdb=l.indexedDB||l.mozIndexedDB||l.webkitIndexedDB||l.msIndexedDB,"object"!=typeof r.indexdb)throw"IndexedDB not supported";r.keyRange=l.IDBKeyRange||l.mozIDBKeyRange||l.webkitIDBKeyRange||l.msIDBKeyRange}var r=this;r.name=e,r.version=n,r.indexdb="",t(),r.open=new l.Promise(function(e,n){var t=r.indexdb.open(r.name,r.version);t.onupgradeneeded=function(n){e(n)},t.onerror=function(e){n(e)},t.onsuccess=function(n){e(n)}})}function t(t,r,i,o,a){function u(n){function t(){x.bound=null,x.index=null,x.caseInsensitive=!1,x.hasFilter=!1,x.filterFunction=null,x.whereInValues=null,x.whereNotInValues=null,x.withTables={},x.hasWith=!1,x.isDesc=!1,x.traverse="next",x.isWhereNumber=!1,x.originalWithRelation=null,x.likeString=null}function r(){var e=[];if(e.push(n.name),x.hasWith){var t=Object.keys(x.withTables);t.forEach(function(n){e.push(n)})}return e}function i(e){var n=angular.copy(e);return n=n.toString(),x.caseInsensitive?(n=n.toLowerCase(),null!==n.match(x.likeString.toLowerCase())):null!==n.match(x.likeString)}function o(i,o){var a=void 0===o||o===!1||null===o?"readonly":"readwrite",u=[],l={};return e(function(e,o){try{R=h.indexdb.open(h.name),R.onsuccess=function(s){var c=s.target.result;u=r(),V=c.transaction(u,a),x.hasWith&&(u.splice(0,1),u.forEach(function(e){l[e]=V.objectStore(e)})),W=V.objectStore(n.name),null!==x.index&&(W=W.index(x.index)),W=W.openCursor(x.bound,x.traverse),W.onsuccess=function(n){try{i(n,e,o,l)}catch(r){t(),o(r)}},W.onerror=function(e){t(),o(e)},V.onerror=function(e){t(),o(e)}},R.onerror=function(e){t(),o(e)}}catch(s){t(),o(s)}})}function a(e,n){return n=void 0===n?!1:n,x.caseInsensitive&&"string"==typeof e&&(e=n===!0?e.toUpperCase():e.toLowerCase()),e}function l(e,n,t){if(x.caseInsensitive){var r=a(e.key);x.whereNotInValues.forEach(function(e){var n=a(angular.copy(e));n===r&&-1===t.indexOf(r)&&t.push(r)}),-1===t.indexOf(r)&&n.push(e.value)}else-1===x.whereNotInValues.indexOf(e.key)&&n.push(e.value);e["continue"](null,x.traverse)}function s(e,n,t,r,i){if(i=void 0===i?!0:i,x.caseInsensitive&&i){var o;return o=a(e.key),r.forEach(function(t){var r=a(angular.copy(t));r===o&&n.push(e.value)}),e["continue"](),0}if(x.isDesc){if(e.key<r[t])return t+=1,e["continue"](),t}else if(e.key>r[t])return t+=1,e["continue"](),t;return e.key!==r[t]?(e["continue"](r[t],x.traverse),t):(n.push(e.value),t+=1,e["continue"](r[t],x.traverse),t)}function c(e,t,r){r=void 0===r?!1:r;var i=angular.copy(e),o=Object.keys(t);return o.forEach(function(e){i[e]=t[e]}),n.hasTimeStamp&&!r&&(i.updatedAt=Date.parse(Date())),r&&(i.updatedAt=Date.parse(Date())),i}function f(e,n){var t=Object.keys(n);return t.forEach(function(t){void 0===e[t]&&(e[t]=[]),n[t].forEach(function(n){if(n>=0)-1===e[t].indexOf(n)&&e[t].push(n);else{var r=e[t].indexOf(-1*n);-1!==r&&e[t].splice(r,1)}})}),e}function d(e,n,t){var r,i=!1;if(x.caseInsensitive){var o;return o=a(e.key),x.whereInValues.forEach(function(e){var n=a(angular.copy(e));n===o&&(i=!0)}),i&&(r=c(e.value,t),x.hasWith&&(r=f(r,x.originalWithRelation)),e.update(r)),e["continue"](),0}if(x.isDesc){if(e.key<x.whereInValues[n])return n+=1,e["continue"](),n}else if(e.key>x.whereInValues[n])return n+=1,e["continue"](),n;return e.key!==x.whereInValues[n]?(e["continue"](x.whereInValues[n]),n):(r=c(e.value,t),x.hasWith&&(r=f(r,x.originalWithRelation)),e.update(r),n+=1,e["continue"](x.whereInValues[n]),n)}function v(e,n,t){var r;if(x.caseInsensitive){var i=a(e.key);x.whereNotInValues.forEach(function(e){var t=a(angular.copy(e));t===i&&-1===n.indexOf(i)&&n.push(i)}),-1===n.indexOf(i)&&(r=c(e.value,t),x.hasWith&&(r=f(r,x.originalWithRelation)),e.update(r))}else-1===x.whereNotInValues.indexOf(e.key)&&(r=c(e.value,t),x.hasWith&&(r=f(r,x.originalWithRelation)),e.update(r));e["continue"]()}function p(e,t,r){var i=!1;if(x.caseInsensitive){var o;return o=a(e.key),x.whereInValues.forEach(function(e){var n=a(angular.copy(e));n===o&&(i=!0)}),i&&(r.push(e.value[n.fields.keyPathField]),e["delete"]()),e["continue"](),0}if(x.isDesc){if(e.key<x.whereInValues[t])return t+=1,e["continue"](),t}else if(e.key>x.whereInValues[t])return t+=1,e["continue"](),t;return e.key!==x.whereInValues[t]?(e["continue"](x.whereInValues[t]),t):(r.push(e.value[n.fields.keyPathField]),e["delete"](),t+=1,e["continue"](x.whereInValues[t]),t)}function y(e,t,r){if(x.caseInsensitive){var i=a(e.key);x.whereNotInValues.forEach(function(e){var n=a(angular.copy(e));n===i&&-1===t.indexOf(i)&&t.push(i)}),-1===t.indexOf(i)&&(r.push(e.value[n.fields.keyPathField]),e["delete"]())}else-1===x.whereNotInValues.indexOf(e.key)&&(r.push(e.value[n.fields.keyPathField]),e["delete"]());e["continue"]()}function g(e,n,r,i,o){if(o=void 0===o?!1:o){if(void 0===r)return t(),void e(r)}else if(0===r.length)return t(),void e(r);var a,u,l,c;c={},l=Object.keys(i),u=l.length;var f=0;a=[],l.forEach(function(l){o?a=angular.copy(r[x.originalWithRelation[l].field]):(r.forEach(function(e){var n=angular.copy(e[x.originalWithRelation[l].field]);void 0!==n&&n.constructor===Array&&n.forEach(function(e){-1===a.indexOf(e)&&a.push(e)})}),c[l]=[]);var d=0,v=[],p=!1;return"function"==typeof x.originalWithRelation[l].filter&&(p=!0),(void 0===a||a.constructor!==Array)&&(t(),e(r)),a=a.sort(),0===a.length?(o?r.Relations=c:r.forEach(function(e){e.Relations=c}),void e(r)):(i[l].openCursor(h.keyRange.bound(a[0],a[a.length-1])).onsuccess=function(i){try{var c=i.target.result;if(c){if(p&&x.originalWithRelation[l].filter(c.value)!==!0)return d+=1,void c["continue"](a[d]);d=s(c,v,d,a,!1)}else o?(r.Relations=r.Relations||{},r.Relations[l]=[],v.forEach(function(e){-1!==r[x.originalWithRelation[l].field].indexOf(e._id)&&r.Relations[l].push(e)})):r.forEach(function(e){e.Relations=e.Relations||{},e.Relations[l]=[],v.forEach(function(n){void 0!==e[x.originalWithRelation[l].field]&&-1!==e[x.originalWithRelation[l].field].indexOf(n._id)&&e.Relations[l].push(n)})}),f+=1,f===u&&(t(),e(r))}catch(h){t(),n(h)}},void(i[l].openCursor(h.keyRange.bound(a[0],a[a.length-1])).onerror=function(e){t(),n(e)}))})}function b(e,r,i,o,a){var u,l;l=Object.keys(o),u=l.length;var s=0,f={};l.forEach(function(l){var d=!1,h=!1,v=[];"function"==typeof x.originalWithRelation[l].filter&&(d=!0),"object"==typeof x.originalWithRelation[l].many&&x.originalWithRelation[l].many.isMany===!0&&(h=!0),o[l].openCursor().onsuccess=function(o){var p=o.target.result;if(p){var y=c(p.value,{},!0);if(d&&x.originalWithRelation[l].filter(angular.copy(p.value))!==!0)return void p["continue"]();void 0===y[x.originalWithRelation[l].field]&&(y[x.originalWithRelation[l].field]=[]),-1===y[x.originalWithRelation[l].field].indexOf(i._id)&&(y[x.originalWithRelation[l].field].push(i._id),h&&v.push(p.value._id)),p.update(y),p["continue"]()}else if(s+=1,h&&(f[x.originalWithRelation[l].many.field]=v),s===u)if(h){i=c(i,f);var g=a.objectStore(n.name);g.put(i).onsuccess=function(){t(),e(i)},g.onerror=function(e){t(),r(e)}}else t(),e(i)},o[l].openCursor().onerror=function(e){t(),r(e)}})}function w(e,n,r,i,o){o=void 0===o?!1:o;var a,u;u=Object.keys(i),a=u.length;var l,s=0;o?(r=r.sort(),l=h.keyRange.bound(r[0],r[r.length-1])):l=h.keyRange.only(r),u.forEach(function(u){i[u].index(x.originalWithRelation[u].field).openCursor(l).onsuccess=function(i){try{var l=i.target.result;if(l){var f=c(l.value,{},!0);if(void 0===f[x.originalWithRelation[u].field])return void l["continue"]();var d;if(o)r.forEach(function(e){d=f[x.originalWithRelation[u].field].indexOf(e),-1!==d&&f[x.originalWithRelation[u].field].splice(d,1)});else{if(d=f[x.originalWithRelation[u].field].indexOf(r),-1===d)return void l["continue"]();f[x.originalWithRelation[u].field].splice(d,1)}l.update(f),l["continue"]()}else s+=1,s===a&&(t(),e())}catch(h){t(),n(h)}},i[u].onerror=function(e){t(),n(e)}})}function m(e){var n=Object.keys(e);n.forEach(function(e){x.withTables[e]=new u(e)})}function I(e,n){return x.isDesc?n-e:e-n}function k(){if(x.isDesc){if(null!==x.whereInValues){if(x.isWhereNumber)return void(x.whereInValues=x.whereInValues.sort(I));x.whereInValues=x.whereInValues.reverse()}if(null!==x.whereNotInValues){if(x.isWhereNumber)return void(x.whereNotInValues=x.whereNotInValues.sort(I));x.whereNotInValues=x.whereNotInValues.reverse()}}else{if(null!==x.whereInValues){if(x.isWhereNumber)return void(x.whereInValues=x.whereInValues.sort(I));x.whereInValues=x.whereInValues.sort()}if(null!==x.whereNotInValues){if(x.isWhereNumber)return void(x.whereNotInValues=x.whereNotInValues.sort(I));x.whereNotInValues=x.whereNotInValues.sort()}}}var R,V,W,x=this;t(),x.orderDesc=function(e){return e===!0?(x.isDesc=!0,x.traverse="prev",k()):(x.isDesc=!1,x.traverse="next",k()),x},x.select=function(e){return e===n.fields.keyPathField?x:(x.index=e,x)},x.equal=function(e){return x.bound=h.keyRange.only(e),x},x.setCaseInsensitive=function(e){var n,t,r,i;return e=void 0===e||e===!0?!0:!1,x.caseInsensitive=e,x.caseInsensitive&&null!==x.bound&&x.bound.lower!==x.bound.upper&&(n=a(angular.copy(x.bound.lower),!0),i=void 0===x.bound.lowerOpen?!1:angular.copy(x.bound.lowerOpen),t=a(angular.copy(x.bound.upper)),r=void 0===x.bound.upper?!1:angular.copy(x.bound.upper),void 0===x.bound.lower?x.bound=h.keyRange.upperBound(t,r):void 0===x.bound.upper?x.bound=h.keyRange.lowerBound(n,i):x.bound=h.keyRange.bound(n,t,i,r)),x},x.find=function(){var i=e(function(e,i){var o=[],a={};try{R=h.indexdb.open(h.name),R.onsuccess=function(u){try{var l=u.target.result;o=r(),V=l.transaction(o),x.hasWith&&(o.splice(0,1),o.forEach(function(e){a[e]=V.objectStore(e)})),W=V.objectStore(n.name),null!==x.index&&(W=W.index(x.index)),W=W.get(x.bound),W.onsuccess=function(n){try{x.hasWith?g(e,i,n.target.result,a,!0):(t(),e(n.target.result))}catch(r){t(),i(r)}},W.onerror=function(e){t(),i(e)},V.onerror=function(e){t(),i(e)}}catch(s){t(),i(s)}},R.onerror=function(e){t(),i(e)}}catch(u){t(),i(u)}});return i},x.add=function(i){var o=e(function(e,o){try{var a=[],u={};R=h.indexdb.open(h.name),R.onsuccess=function(l){try{var s=l.target.result;a=r(),V=s.transaction(a,"readwrite"),x.hasWith&&(a.splice(0,1),a.forEach(function(e){u[e]=V.objectStore(e)})),W=V.objectStore(n.name),n.hasTimeStamp&&(i.updatedAt=Date.parse(Date()),i.createdAt=Date.parse(Date())),W=W.add(i),W.onsuccess=function(r){try{var a;a=i,a[n.fields.keyPathField]=r.target.result,x.hasWith?b(e,o,a,u,V):(t(),e(a))}catch(l){t(),o(l)}},V.onerror=function(e){t(),o(e.srcElement.error)}}catch(c){t(),o(c)}},R.onerror=function(e){t(),o(e)}}catch(l){o(l)}});return o},x.addMultiple=function(r){var i=[],o=r.length,a=0,u=e(function(e,u){try{R=h.indexdb.open(h.name),R.onsuccess=function(l){try{var s=l.target.result;V=s.transaction([n.name],"readwrite");try{W=V.objectStore(n.name),r.forEach(function(l){n.hasTimeStamp&&(l.updatedAt=Date.parse(Date()),l.createdAt=Date.parse(Date())),W.add(l).onsuccess=function(l){try{var s;s=r[a],s[n.fields.keyPathField]=l.target.result,i.push(s),a+=1,a===o&&(t(),e(i))}catch(c){t(),u(c)}}})}catch(c){return t(),void u(c)}V.onerror=function(e){t(),u(e.srcElement.error)}}catch(c){t(),u(c)}},R.onerror=function(e){t(),u(e.srcElement.error)}}catch(l){t(),u(l)}});return u},x.between=function(e,n,t,r){return t=void 0!==t?!1:t,r=void 0!==r?!1:r,x.bound=h.keyRange.bound(e,n,t,r),x},x.whereIn=function(e,n){return n=n===!0?!0:!1,x.whereInValues=e,x.isWhereNumber=n,k(),x},x.gt=function(e){return e=a(e,!0),x.bound=h.keyRange.lowerBound(e,!0),x},x.gte=function(e){return e=a(e,!0),x.bound=h.keyRange.lowerBound(e),x},x.lte=function(e){return e=a(e),x.bound=h.keyRange.upperBound(e),x},x.lt=function(e){return e=a(e),x.bound=h.keyRange.upperBound(e,!0),x},x.getAll=function(){var e=[],n=0,r=[],a=o(function(o,a,u,c){var f=o.target.result;if(f){if(x.hasFilter&&x.filterFunction(f.value)!==!0)return void f["continue"]();if(null!==x.likeString&&i(f.key)===!1)return void f["continue"]();null!==x.whereInValues?n=s(f,e,n,x.whereInValues):null!==x.whereNotInValues?l(f,e,r):(e.push(f.value),f["continue"]())}else x.hasWith?g(a,u,e,c):(t(),a(e))});return a},x.whereNotIn=function(e,n){return n=n===!0?!0:!1,x.whereNotInValues=e,x.isWhereNumber=n,k(),x},x.put=function(r){var i=e(function(e,i){try{R=h.indexdb.open(h.name),R.onsuccess=function(o){var a=o.target.result;V=a.transaction([n.name],"readwrite"),W=V.objectStore(n.name),n.hasTimeStamp&&(r.updatedAt=Date.parse(Date()),void 0===r.createdAt&&(r.createdAt=Date.parse(Date()))),W=W.put(r),W.onsuccess=function(o){try{r[n.keyPathField]=o.target.result,t(),e(r)}catch(a){t(),i(a)}},W.onerror=function(e){t(),i(e)},V.onerror=function(e){t(),i(e)}},R.onerror=function(e){t(),i(e.srcElement.error)}}catch(o){t(),i(o)}});return i},x.update=function(e){if("object"!=typeof e)throw"Data must be type of object";var n=0,r=[],a=o(function(o,a){var u,l=o.target.result;if(l){if(x.hasFilter&&x.filterFunction(l.value)!==!0)return void l["continue"]();if(null!==x.likeString&&i(l.key)===!1)return void l["continue"]();null!==x.whereInValues?n=d(l,n,e):null!==x.whereNotInValues?v(l,r,e):(u=c(l.value,e),x.hasWith&&(u=f(u,x.originalWithRelation)),l.update(u),l["continue"]())}else t(),a()},!0);return a},x.filter=function(e){return x.hasFilter=!0,x.filterFunction=e,x},x["delete"]=function(i){if(void 0===i)throw"Empty value provided for deleting";var o=e(function(e,o){try{R=h.indexdb.open(h.name),R.onsuccess=function(a){var u=a.target.result,l={},s=r();V=u.transaction(s,"readwrite"),x.hasWith&&(s.splice(0,1),s.forEach(function(e){l[e]=V.objectStore(e)})),W=V.objectStore(n.name),W=W["delete"](i),W.onsuccess=function(){try{x.hasWith?w(e,o,i,l):(t(),e())}catch(n){t(),o(n)}},W.onerror=function(e){t(),o(e)},V.onerror=function(e){t(),o(e)}},R.onerror=function(e){t(),o(e)}}catch(a){t(),o(a)}});return o},x.destroy=function(){var e=0,r=[],a=[],u=o(function(o,u,l,s){var c=o.target.result;if(c){if(x.hasFilter&&x.filterFunction(c.value)!==!0)return void c["continue"]();if(null!==x.likeString&&i(c.key)===!1)return void c["continue"]();null!==x.whereInValues?e=p(c,e,a):null!==x.whereNotInValues?y(c,r,a):(a.push(c.value[n.fields.keyPathField]),c["delete"](),c["continue"]())}else x.hasWith?w(u,l,a,s,!0):(t(),u())},!0);return u},x.withRelations=function(e){if("object"!=typeof e)throw"WithRelation must be at type of object";return x.hasWith=!0,x.originalWithRelation=e,x.withRelation=m(e),x},x.like=function(e){if(void 0===e)throw"Invalid input given to like";return x.likeString=e.toString(),x}}function l(e){var n={};return e.hasOwnProperty("unique")&&e.unique&&(n.unique=!0),e.hasOwnProperty("multiEntry")&&e.multiEntry&&(n.multiEntry=!0),n}function s(e){return void 0===e.keyPathValue?e.name:e.keyPathValue}function c(e){var n,t;h.tables.forEach(function(r){e.objectStoreNames.contains(r.name)||(n=e.createObjectStore(r.name,{keyPath:r.fields.keyPathField,autoIncrement:!0}),r.fields.other.forEach(function(e){var r=s(e);t=l(e),n.createIndex(e.name,r,t)})),h.models[r.name]=new u(r)})}function f(e,n){var t,r,i,o;for(i=!1,o={},o.other=[],t=e.length-1;t>=0;t--)if(r=e[t],r.hasOwnProperty("keyPath"))if(r.keyPath===!0){if(i===!0)throw"Error multiple keyPath defined in table "+n;o.keyPathField=r.name,i=!0}else o.other.push(r);else o.other.push(r);return i||(o.keyPathField="id"),o}function d(){var e,n,t;for(e=h.tables.length-1;e>=0;e--)n=h.tables[e],n.hasTimeStamp=!1,t=f(n.fields,n.name),n.fields=t,n.timeStamps===!0&&(n.hasTimeStamp=!0,n.indexOnTimeStamps===!0&&(n.fields.other.push({name:"updatedAt",keyPathValue:"updatedAt",multiEntry:!0}),n.fields.other.push({name:"createdAt",keyPathValue:"createdAt",multiEntry:!0})))}n.apply(this,[t,r]);var h=this;h.tables=i||[],h.models={},d(),h.open.then(function(e){"upgradeneeded"===e.type?c(e.target.result):h.tables.forEach(function(e){h.models[e.name]=new u(e)}),o(h)})["catch"](function(e){a(e)})}return e(function(e,n){var r=new t(o,a,u,e,n);return r})}function t(e){o=e}function r(e){u=e}function i(e){a=e}var o,a,u,l=e.$get();return o="test",a=1,u=[],n.$inject=["$q"],{setDbName:t,setDbVersion:i,setDbTables:r,$get:n}}indexeddbProvider.$inject=["$windowProvider"],angular.module("indexed-db",[]),angular.module("indexed-db").provider("indexeddb",indexeddbProvider);
//# sourceMappingURL=angular-indexeddb.min.js.map