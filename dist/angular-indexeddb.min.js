function indexeddbProvider(e){"use strict";function n(e){function n(e,n){function t(){if(r.indexdb=l.indexedDB||l.mozIndexedDB||l.webkitIndexedDB||l.msIndexedDB,"object"!=typeof r.indexdb)throw"IndexedDB not supported";r.keyRange=l.IDBKeyRange||l.mozIDBKeyRange||l.webkitIDBKeyRange||l.msIDBKeyRange}var r=this;r.name=e,r.version=n,r.indexdb="",t(),r.open=new l.Promise(function(e,n){var t=r.indexdb.open(r.name,r.version);t.onupgradeneeded=function(n){e(n)},t.onerror=function(e){n(e.srcElement.error)},t.onsuccess=function(n){e(n)}})}function t(t,r,i,o,a){function u(n){function t(){I.bound=null,I.index=null,I.caseInsensitive=!1,I.hasFilter=!1,I.filterFunction=null,I.whereInValues=null,I.whereNotInValues=null,I.withTables={},I.hasWith=!1}function r(){var e=[];if(e.push(n.name),I.hasWith){var t=Object.keys(I.withTables);t.forEach(function(n){e.push(n)})}return e}function i(i,o){var a=void 0===o||o===!1||null===o?"readonly":"readwrite",u=[],l={};return e(function(e,o){w=h.indexdb.open(h.name),w.onsuccess=function(s){var c=s.target.result;u=r(),k=c.transaction(u,a),I.hasWith&&(u.splice(0,1),u.forEach(function(e){l[e]=k.objectStore(e)})),R=k.objectStore(n.name),null!==I.index&&(R=R.index(I.index)),R=R.openCursor(I.bound),R.onsuccess=function(n){i(n,e,o,l)},R.onerror=function(e){t(),o(e.srcElement.error)},k.onerror=function(e){t(),o(e.srcElement.error)}},w.onerror=function(e){t(),o(e.srcElement.error)}})}function o(e,n){return n=void 0===n?!1:n,I.caseInsensitive&&"string"==typeof e&&(e=n===!0?e.toUpperCase():e.toLowerCase()),e}function a(e,n,t){if(I.caseInsensitive){var r=o(e.key);I.whereNotInValues.forEach(function(e){var n=o(angular.copy(e));n===r&&-1===t.indexOf(r)&&t.push(r)}),-1===t.indexOf(r)&&n.push(e.value)}else-1===I.whereNotInValues.indexOf(e.key)&&n.push(e.value);e["continue"]()}function l(e,n,t,r,i){if(i=void 0===i?!0:i,I.caseInsensitive&&i){var a;return a=o(e.key),r.forEach(function(t){var r=o(angular.copy(t));r===a&&n.push(e.value)}),e["continue"](),0}return e.key>r[t]?(t+=1,e["continue"](),t):e.key!==r[t]?(e["continue"](r[t]),t):(n.push(e.value),t+=1,e["continue"](r[t]),t)}function s(e,t,r){r=void 0===r?!1:r;var i=angular.copy(e),o=Object.keys(t);return o.forEach(function(e){i[e]=t[e]}),n.hasTimeStamp&&!r&&(i.updatedAt=Date.parse(Date())),r&&(i.updatedAt=Date.parse(Date())),i}function c(e,n,t){var r=!1,i=s(e.value,t);if(I.caseInsensitive){var a;return a=o(e.key),I.whereInValues.forEach(function(e){var n=o(angular.copy(e));n===a&&(r=!0)}),r&&e.update(i),e["continue"](),0}return e.key>I.whereInValues[n]?(e["continue"](),n+=1):e.key!==I.whereInValues[n]?(e["continue"](I.whereInValues[n]),n):(e.update(i),n+=1,e["continue"](I.whereInValues[n]),n)}function d(e,n,t){var r=s(e.value,t);if(I.caseInsensitive){var i=o(e.key);I.whereNotInValues.forEach(function(e){var t=o(angular.copy(e));t===i&&-1===n.indexOf(i)&&n.push(i)}),-1===n.indexOf(i)&&e.update(r)}else-1===I.whereNotInValues.indexOf(e.key)&&e.update(r);e["continue"]()}function f(e,t,r){var i=!1;if(I.caseInsensitive){var a;return a=o(e.key),I.whereInValues.forEach(function(e){var n=o(angular.copy(e));n===a&&(i=!0)}),i&&(r.push(e.value[n.fields.keyPathField]),e["delete"]()),e["continue"](),0}return e.key>I.whereInValues[t]?(e["continue"](),t+=1):e.key!==I.whereInValues[t]?(e["continue"](I.whereInValues[t]),t):(r.push(e.value[n.fields.keyPathField]),e["delete"](),t+=1,e["continue"](I.whereInValues[t]),t)}function v(e,t,r){if(I.caseInsensitive){var i=o(e.key);I.whereNotInValues.forEach(function(e){var n=o(angular.copy(e));n===i&&-1===t.indexOf(i)&&t.push(i)}),-1===t.indexOf(i)&&(r.push(e.value[n.fields.keyPathField]),e["delete"]())}else-1===I.whereNotInValues.indexOf(e.key)&&(r.push(e.value[n.fields.keyPathField]),e["delete"]());e["continue"]()}function p(e,n,r,i,o){if(o=void 0===o?!1:o){if(void 0===r)return t(),void e(r)}else if(0===r.length)return t(),void e(r);var a,u,s;s=Object.keys(i),u=s.length;var c=0;a=[],s.forEach(function(s){o?a=angular.copy(r[I.originalWithRelation[s].field]):r.forEach(function(e){var n=angular.copy(e[I.originalWithRelation[s].field]);void 0!==n&&n.constructor===Array&&n.forEach(function(e){-1===a.indexOf(e)&&a.push(e)})});var d=0,f=[],v=!1;"function"==typeof I.originalWithRelation[s].filter&&(v=!0),a=a.sort(),i[s].openCursor(h.keyRange.bound(a[0],a[a.length-1])).onsuccess=function(n){var i=n.target.result;if(i){if(v&&I.originalWithRelation[s].filter(i.value)!==!0)return d+=1,void i["continue"](a[d]);d=l(i,f,d,a,!1)}else o?(r.Relations=r.Relations||{},r.Relations[s]=[],f.forEach(function(e){-1!==r[I.originalWithRelation[s].field].indexOf(e._id)&&r.Relations[s].push(e)})):r.forEach(function(e){e.Relations=e.Relations||{},e.Relations[s]=[],f.forEach(function(n){-1!==e[I.originalWithRelation[s].field].indexOf(n._id)&&e.Relations[s].push(n)})}),c+=1,c===u&&(t(),e(r))},i[s].openCursor(h.keyRange.bound(a[0],a[a.length-1])).onerror=function(e){t(),n(e)}})}function y(e,r,i,o,a){var u,l;l=Object.keys(o),u=l.length;var c=0,d={};l.forEach(function(l){var f=!1,h=!1,v=[];"function"==typeof I.originalWithRelation[l].filter&&(f=!0),"object"==typeof I.originalWithRelation[l].many&&I.originalWithRelation[l].many.isMany===!0&&(h=!0),o[l].openCursor().onsuccess=function(o){var p=o.target.result;if(p){var y=s(p.value,{},!0);if(f&&I.originalWithRelation[l].filter(angular.copy(p.value))!==!0)return void p["continue"]();void 0===y[I.originalWithRelation[l].field]&&(y[I.originalWithRelation[l].field]=[]),-1===y[I.originalWithRelation[l].field].indexOf(i._id)&&(y[I.originalWithRelation[l].field].push(i._id),i.Relations=i.Relations||{},i.Relations[l]=i.Relations[l]||[],i.Relations[l].push(p.value),h&&v.push(p.value._id)),p.update(y),p["continue"]()}else if(c+=1,h&&(d[I.originalWithRelation[l].many.field]=v),c===u)if(h){i=s(i,d);var g=a.objectStore(n.name);g.put(i).onsuccess=function(){t(),e(i)},g.onerror=function(e){t(),r(e)}}else t(),e(i)},o[l].openCursor().onerror=function(e){t(),r(e)}})}function g(e,n,r,i,o){o=void 0===o?!1:o;var a,u;u=Object.keys(i),a=u.length;var l,c=0;o?(r=r.sort(),l=h.keyRange.bound(r[0],r[r.length-1])):l=h.keyRange.only(r),u.forEach(function(u){i[u].index(I.originalWithRelation[u].field).openCursor(l).onsuccess=function(n){var i=n.target.result;if(i){var l=s(i.value,{},!0);if(void 0===l[I.originalWithRelation[u].field])return void i["continue"]();var d;if(o)r.forEach(function(e){d=l[I.originalWithRelation[u].field].indexOf(e),-1!==d&&l[I.originalWithRelation[u].field].splice(d,1)});else{if(d=l[I.originalWithRelation[u].field].indexOf(r),-1===d)return void i["continue"]();l[I.originalWithRelation[u].field].splice(d,1)}i.update(l),i["continue"]()}else c+=1,c===a&&(t(),e())},i[u].onerror=function(e){t(),n(e)}})}function b(e){var n=Object.keys(e);n.forEach(function(e){I.withTables[e]=new u(e)})}function m(e,n){return e-n}var w,k,R,I=this;I.bound=null,I.index=null,I.caseInsensitive=!1,I.hasFilter=!1,I.filterFunction=null,I.whereInValues=null,I.whereNotInValues=null,I.withTables={},I.hasWith=!1,I.select=function(e){return e===n.fields.keyPathField?I:(I.index=e,I)},I.equal=function(e){return I.bound=h.keyRange.only(e),I},I.setCaseInsensitive=function(e){var n,t,r,i;return e=void 0===e||e===!0?!0:!1,I.caseInsensitive=e,I.caseInsensitive&&null!==I.bound&&I.bound.lower!==I.bound.upper&&(n=o(angular.copy(I.bound.lower),!0),i=void 0===I.bound.lowerOpen?!1:angular.copy(I.bound.lowerOpen),t=o(angular.copy(I.bound.upper)),r=void 0===I.bound.upper?!1:angular.copy(I.bound.upper),void 0===I.bound.lower?I.bound=h.keyRange.upperBound(t,r):void 0===I.bound.upper?I.bound=h.keyRange.lowerBound(n,i):I.bound=h.keyRange.bound(n,t,i,r)),I},I.find=function(){var i=e(function(e,i){var o=[],a={};w=h.indexdb.open(h.name),w.onsuccess=function(u){var l=u.target.result;o=r(),k=l.transaction(o),I.hasWith&&(o.splice(0,1),o.forEach(function(e){a[e]=k.objectStore(e)})),R=k.objectStore(n.name),null!==I.index&&(R=R.index(I.index)),R.get(I.bound).onsuccess=function(n){I.hasWith?p(e,i,n.target.result,a,!0):(t(),e(n.target.result))},k.onerror=function(e){t(),i(e.srcElement.error)}},w.onerror=function(e){t(),i(e.srcElement.error)}});return i},I.add=function(i){var o=e(function(e,o){var a=[],u={};w=h.indexdb.open(h.name),w.onsuccess=function(l){var s=l.target.result;a=r(),k=s.transaction(a,"readwrite"),I.hasWith&&(a.splice(0,1),a.forEach(function(e){u[e]=k.objectStore(e)})),R=k.objectStore(n.name),n.hasTimeStamp&&(i.updatedAt=Date.parse(Date()),i.createdAt=Date.parse(Date())),R=R.add(i),R.onsuccess=function(r){var a;a=i,a[n.fields.keyPathField]=r.target.result,I.hasWith?y(e,o,a,u,k):(t(),e(a))},k.onerror=function(e){t(),o(e.srcElement.error)}},w.onerror=function(e){t(),o(e.srcElement.error)}});return o},I.addMultiple=function(r){var i=[],o=r.length,a=0,u=e(function(e,u){w=h.indexdb.open(h.name),w.onsuccess=function(l){var s=l.target.result;k=s.transaction([n.name],"readwrite"),R=k.objectStore(n.name),r.forEach(function(u){n.hasTimeStamp&&(u.updatedAt=Date.parse(Date()),u.createdAt=Date.parse(Date())),R.add(u).onsuccess=function(u){var l;l=r[a],l[n.fields.keyPathField]=u.target.result,i.push(l),a+=1,a===o&&(t(),e(i))}}),k.onerror=function(e){t(),u(e.srcElement.error)}},w.onerror=function(e){t(),u(e.srcElement.error)}});return u},I.between=function(e,n,t,r){return t=void 0!==t?!1:t,r=void 0!==r?!1:r,I.bound=h.keyRange.bound(e,n,t,r),I},I.whereIn=function(e,n){return n=void 0===n?!1:n,e=n===!0?e.sort(m):e.sort(),I.whereInValues=e,I},I.gt=function(e){return e=o(e,!0),I.bound=h.keyRange.lowerBound(e,!0),I},I.gte=function(e){return e=o(e,!0),I.bound=h.keyRange.lowerBound(e),I},I.lte=function(e){return e=o(e),I.bound=h.keyRange.upperBound(e),I},I.lt=function(e){return e=o(e),I.bound=h.keyRange.upperBound(e,!0),I},I.getAll=function(){var e=[],n=0,r=[],o=i(function(i,o,u,s){var c=i.target.result;if(c){if(I.hasFilter&&I.filterFunction(c.value)!==!0)return void c["continue"]();null!==I.whereInValues?n=l(c,e,n,I.whereInValues):null!==I.whereNotInValues?a(c,e,r):(e.push(c.value),c["continue"]())}else I.hasWith?p(o,u,e,s):(t(),o(e))});return o},I.whereNotIn=function(e,n){return n=void 0===n?!1:n,e=n===!0?e.sort(m):e.sort(),I.whereNotInValues=e,I},I.put=function(r){var i=e(function(e,i){w=h.indexdb.open(h.name),w.onsuccess=function(o){var a=o.target.result;k=a.transaction([n.name],"readwrite"),R=k.objectStore(n.name),n.hasTimeStamp&&(r.updatedAt=Date.parse(Date()),void 0===r.createdAt&&(r.createdAt=Date.parse(Date()))),R=R.put(r),R.onsuccess=function(i){r[n.keyPathField]=i.target.result,t(),e(r)},k.onerror=function(e){t(),i(e.srcElement.error)}},w.onerror=function(e){t(),i(e.srcElement.error)}});return i},I.update=function(e){if("object"!=typeof e)throw"Data must be type of object";var n=0,r=[],o=i(function(i,o){var a,u=i.target.result;if(u){if(I.hasFilter&&I.filterFunction(u.value)!==!0)return void u["continue"]();null!==I.whereInValues?n=c(u,n,e):null!==I.whereNotInValues?d(u,r,e):(a=s(u,e),u.update(a),u["continue"]())}else t(),o()},!0);return o},I.filter=function(e){return I.hasFilter=!0,I.filterFunction=e,I},I["delete"]=function(i){if(void 0===i)throw"Empty value provided for deleting";var o=e(function(e,o){w=h.indexdb.open(h.name),w.onsuccess=function(a){var u=a.target.result,l={},s=r();k=u.transaction(s,"readwrite"),I.hasWith&&(s.splice(0,1),s.forEach(function(e){l[e]=k.objectStore(e)})),R=k.objectStore(n.name),R=R["delete"](i),R.onsuccess=function(){I.hasWith?g(e,o,i,l):(t(),e())},k.onerror=function(e){t(),o(e.srcElement.error)}},w.onerror=function(e){t(),o(e.srcElement.error)}});return o},I.destroy=function(){var e=0,r=[],o=[],a=i(function(i,a,u,l){var s=i.target.result;if(s){if(I.hasFilter&&I.filterFunction(s.value)!==!0)return void s["continue"]();null!==I.whereInValues?e=f(s,e,o):null!==I.whereNotInValues?v(s,r,o):(o.push(s.value[n.fields.keyPathField]),s["delete"](),s["continue"]())}else I.hasWith?g(a,u,o,l,!0):(t(),a())},!0);return a},I.withRelations=function(e){if("object"!=typeof e)throw"WithRelation must be at type of object";return I.hasWith=!0,I.originalWithRelation=e,I.withRelation=b(e),I}}function l(e){var n={};return e.hasOwnProperty("unique")&&e.unique&&(n.unique=!0),e.hasOwnProperty("multiEntry")&&e.multiEntry&&(n.multiEntry=!0),n}function s(e){return void 0===e.keyPathValue?e.name:e.keyPathValue}function c(e){var n,t;h.tables.forEach(function(r){e.objectStoreNames.contains(r.name)||(n=e.createObjectStore(r.name,{keyPath:r.fields.keyPathField,autoIncrement:!0}),r.fields.other.forEach(function(e){var r=s(e);t=l(e),n.createIndex(e.name,r,t)})),h.models[r.name]=new u(r)})}function d(e,n){var t,r,i,o;for(i=!1,o={},o.other=[],t=e.length-1;t>=0;t--)if(r=e[t],r.hasOwnProperty("keyPath"))if(r.keyPath===!0){if(i===!0)throw"Error multiple keyPath defined in table "+n;o.keyPathField=r.name,i=!0}else o.other.push(r);else o.other.push(r);return i||(o.keyPathField="id"),o}function f(){var e,n,t;for(e=h.tables.length-1;e>=0;e--)n=h.tables[e],n.hasTimeStamp=!1,t=d(n.fields,n.name),n.fields=t,n.timeStamps===!0&&(n.hasTimeStamp=!0,n.indexOnTimeStamps===!0&&(n.fields.other.push({name:"updatedAt",keyPathValue:"updatedAt",multiEntry:!0}),n.fields.other.push({name:"createdAt",keyPathValue:"createdAt",multiEntry:!0})))}n.apply(this,[t,r]);var h=this;h.tables=i||[],h.models={},f(),h.open.then(function(e){"upgradeneeded"===e.type?c(e.target.result):h.tables.forEach(function(e){h.models[e.name]=new u(e)}),o(h)})["catch"](function(e){a(e)})}return e(function(e,n){var r=new t(o,a,u,e,n);return r})}function t(e){o=e}function r(e){u=e}function i(e){a=e}var o,a,u,l=e.$get();return o="test",a=1,u=[],n.$inject=["$q"],{setDbName:t,setDbVersion:i,setDbTables:r,$get:n}}indexeddbProvider.$inject=["$windowProvider"],angular.module("indexed-db",[]),angular.module("indexed-db").provider("indexeddb",indexeddbProvider);
//# sourceMappingURL=angular-indexeddb.min.js.map